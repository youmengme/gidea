{"posts":[{"title":"1. å®ç°ä¸€ä¸ªå¸¦å¹¶å‘é™åˆ¶çš„Promise.all","content":" å¤´æ¡çš„ä¸€é“é¢è¯•é¢˜~~~ emm æœ‰ç‚¹æ„æ€ åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå¦‚ç”¨æˆ·è¿›å…¥é¡µé¢ï¼Œä¸€èˆ¬ä¼šé€šè¿‡httpè¯·æ±‚åƒæœåŠ¡ç«¯è·å–æ•°æ®ï¼Œè€Œä¸”å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šæœ‰å¤šä¸ªhttpè¯·æ±‚ã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨Promise.allæ¥è°ƒç”¨æ¥å£ï¼Œä»¥è¾¾åˆ°æ›´å¿«é€Ÿåº¦çš„æ‹¿åˆ°æ•°æ®æ¸²æŸ“é¡µé¢ã€‚Promise.allä¼šåœ¨æ•°ç»„ä¸­çš„æ‰€æœ‰promiseè¾¾åˆ°resolveçŠ¶æ€åï¼Œæ‰ä¼šå»æ‰§è¡Œ.thençš„å›è°ƒã€‚ ä½†æ˜¯è¿™æ ·ä¹Ÿç»™æœåŠ¡å™¨å¸¦æ¥äº†æ›´å¤§çš„å‹åŠ›ã€‚å¯ä»¥æƒ³è±¡ä¸€ç§æƒ…å†µï¼Œå¦‚æœé¡µé¢ä¸Šæœ‰10w+è¯·æ±‚å¾…å¤„ç†(è¿™é‡Œæš‚ä¸è€ƒè™‘æµè§ˆå™¨çš„è¯·æ±‚å¹¶å‘é™åˆ¶)ï¼Œä½ åˆåªèƒ½åœ¨æ‹¿åˆ°æ‰€æœ‰è¯·æ±‚çš„ç»“æœåæ‰èƒ½å¤šç»“æœè¿›è¡Œå¤„ç†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§å®¶ç†æ‰€å½“ç„¶çš„æƒ³åˆ°äº†Promise.allã€‚ä½†æ˜¯é¢å¯¹æ´ªæ°´èˆ¬çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå‡ºç°TCPè¿æ¥æ•°ä¸è¶³ç…§æˆç­‰å¾…æˆ–æ‹’ç»è¿æ¥ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹Promise.allè¿›è¡Œå¹¶å‘é™åˆ¶ã€‚ Promise.allå¹¶å‘é™åˆ¶æŒ‡çš„æ˜¯å¦‚æœæœ‰10ä¸ªè¯·æ±‚ï¼Œå¹¶å‘é™åˆ¶æ˜¯5ã€‚é‚£ä¹ˆä¼šåœ¨æ‰§è¡Œçš„ä¸€ç¬é—´å‘å‡ºè¯·æ±‚1, 2, 3, 4, 5ï¼Œå½“è¿™5ä¸ªè¯·æ±‚ä¸­ä»»æ„ä¸€ä¸ªæˆåŠŸæˆ–å¤±è´¥åï¼Œç»§ç»­è¯·æ±‚6ï¼Œå¾ªç¯å¾€å¤ï¼Œç›´è‡³10ä¸ªè¯·æ±‚å…¨éƒ¨å®Œæˆã€‚ç„¶åä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰è¯·æ±‚çš„ç»“æœã€‚ä»è¡¨ç°ä¸Šæ¥çœ‹å’ŒåŸæ¥çš„Promise.allæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ å¤§è‡´æ€è·¯ awaitä¸€ä¸ªpromiseä¼šæš‚åœå½“å‰ä»£ç æ®µç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°promiseå‘ç”Ÿæ”¹å˜ã€‚ Promise.race(promises)ä¼šåœ¨promisesä¸­ä»»æ„ä¸€ä¸ªpromiseå‘ç”ŸçŠ¶æ€æ”¹å˜æ—¶è¿”å›ç»“æœã€‚ å¦‚æœä¾æ¬¡å¾ªç¯æ‰€æœ‰å¾…æ‰§è¡Œçš„è¯·æ±‚ï¼Œå°†å…¶æ”¾å…¥å¾…æ‰§è¡Œåˆ—è¡¨ä¸­ï¼Œæ•°é‡è¾¾åˆ°å¹¶å‘é™åˆ¶æ—¶ï¼Œä½¿ç”¨await Promise.raceæš‚åœä»£ç æ®µå¹¶æ‰§è¡Œè¿™äº›è¯·æ±‚ Promise.raceçŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œç»§ç»­å¾ªç¯ï¼Œç›´è‡³æ‰§è¡Œå®Œæ‰€æœ‰è¯·æ±‚ã€‚ è¯»åˆ°è¿™é‡Œæ˜¯å¦æœ‰æ€è·¯äº†å‘¢ï¼Ÿå¦‚æœæœ‰ï¼Œé‚£å°±è‡ªå·±å…ˆå†™ç€è¯•è¯•ã€‚çœ‹ç­”æ¡ˆå’Œæ€è€ƒå¾—åˆ°çš„ç»“æœè®°å¿†æ·±åº¦æ˜¯ä¸ä¸€æ ·çš„å“¦~~ ä»£ç å®ç° å®šä¹‰ä¸¤ä¸ªå˜é‡,arrayè¡¨ç¤ºå¾…æ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨ï¼Œlimitè¡¨ç¤ºå¹¶å‘é™åˆ¶ éå†å¾…æ‰§è¡Œçš„å‡½æ•°æ•°ç»„ ä»arrayç¬¬1ä¸ªå…ƒç´ å¼€å§‹ï¼Œåˆå§‹åŒ–promiseå¯¹è±¡ï¼ŒåŒæ—¶ç”¨ä¸€ä¸ªexecutingæ•°ç»„ä¿å­˜æ­£åœ¨æ‰§è¡Œçš„promiseï¼Œå¹¶å°†å…¶å­˜æ”¾äºretä¸­ å¾ªç¯åˆå§‹åŒ–promiseï¼Œç›´åˆ°è¾¾åˆ°limt ä½¿ç”¨await Promise.raceï¼Œæš‚åœforå¾ªç¯ï¼Œå¹¶æ‰§è¡Œexecutingä¸­çš„promiseã€‚ å½“executingä¸­æœ‰ä»»æ„ä¸€ä¸ªpromiseæ‰§è¡Œå®Œæ¯•ï¼Œå°±ç»§ç»­forå¾ªç¯ï¼Œä¸æ–­åˆå§‹åŒ–promiseå¹¶æ”¾å…¥executingä¸­ï¼ŒçŸ¥é“è¾¾åˆ°limit å½“æ‰€æœ‰promiseéƒ½æ‰§è¡Œå®Œäº†ï¼Œè°ƒç”¨Promise.allè¿”å› async function asyncPool(array, limit) { // å­˜å‚¨Promiseçš„æ‰§è¡Œç»“æœ const ret = [] // æ­£åœ¨æ‰§è¡Œçš„promise const executing = [] // éå†å¾…æ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨ for (const item of array) { // promiseåŒ…è£…å¹¶æ‰§è¡Œå½“å‰å¾…æ‰§è¡Œå‡½æ•° const p = Promise.resolve().then(() =&gt; item(1)) // å°†å‡½æ•°å­˜è‡³retç»“æœåˆ—è¡¨ä¸­(pæ­¤æ—¶æ˜¯ Promise { &lt;pending&gt; }) ret.push(p) if (limit &lt;= array.length) { // åœ¨p.thenæ‰§è¡Œçš„æ—¶å€™è¯´æ˜pçš„çŠ¶æ€å·²ç»å‘ç”Ÿäº†ç¿»è½¬(resolve || reject), // æ­¤æ—¶å°†executingåˆ—è¡¨åˆ é™¤ä¸€ä¸ª p.then(() =&gt; executing.splice(0, 1)) // å°†på­˜æ”¾è‡³executingä¸­ executing.push(p) // executingå†…çš„å¾…æ‰§è¡Œæ•°é‡å¤§äºç­‰äºlimitçš„æ—¶å€™ï¼Œä½¿ç”¨await Promise.raceæš‚åœforå¾ªç¯ï¼Œ // executingä¸­ä»»æ„ä¸€ä¸ªpromiseå‘ç”ŸçŠ¶æ€æ”¹å˜ï¼Œå°±ä¼šç»§ç»­å¾ªç¯ if (executing.length &gt;= limit) await Promise.race(executing) } } return Promise.all(ret) } asyncPool([], 10).then(result =&gt; console.log(result)) æµ‹è¯•ç”¨ä¾‹ const delay = s =&gt; new Promise(resolve =&gt; setTimeout(resolve, s * 1000)) async function request(index) { console.log(`Request: ${index}`) await delay(1) console.log(`Response: ${index}`) return index } const pool = [...new Array(50).keys()].fill(request) async function asyncPool(array, limit) { const ret = [] const executing = [] for (const itemIndex in array) { const item = array[itemIndex] const p = Promise.resolve().then(() =&gt; item(itemIndex)) ret.push(p) if (limit &lt;= array.length) { p.then(() =&gt; executing.splice(0, 1)) // console.log('executing', executing) executing.push(p) if (executing.length &gt;= limit) await Promise.race(executing) } } return Promise.all(ret) } asyncPool(pool, 10).then(result =&gt; console.log(result)) æ€»ç»“ è¿™ä¸ªé¢è¯•é¢˜ä¸»è¦è€ƒäº†å¤šPromiseçš„ç†è§£ä¸è¿ç”¨ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šä¸ªç‰ˆæœ¬çš„å®ç°ï¼Œé€’å½’è°ƒç”¨çš„å±…å¤šã€‚emmm...æˆ‘ä¸å–œæ¬¢é€’å½’ï¼Œæ‰€ä»¥æ²¡ç”¨é€’å½’ã€‚ æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¦‚æœè®°å¾—ä¸æ˜¯å¾ˆæ·±åˆ»ï¼Œå»ºè®®Ctrl + Dæ”¶è—åˆ°ä¹¦ç­¾ï¼Œä¸‹æ¬¡è®¿é—®æ›´ä¾¿æ·ã€‚ ","link":"https://youmengme.github.io/gidea/post/1-shi-xian-yi-ge-dai-bing-fa-xian-zhi-de-promiseall/"},{"title":"Hello Gridea","content":"ğŸ‘ æ¬¢è¿ä½¿ç”¨ Gridea ï¼ âœï¸ Gridea ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ... Github Gridea ä¸»é¡µ ç¤ºä¾‹ç½‘ç«™ ç‰¹æ€§ğŸ‘‡ ğŸ“ ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ Markdown è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ ğŸŒ‰ ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡ ğŸ·ï¸ ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„ ğŸ“‹ ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå• ğŸ’» ä½ å¯ä»¥åœ¨ Windowsï¼ŒMacOS æˆ– Linux è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯ ğŸŒ ä½ å¯ä»¥ä½¿ç”¨ ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ æˆ– Coding Pages å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å° ğŸ’¬ ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ Gitalk æˆ– DisqusJS è¯„è®ºç³»ç»Ÿ ğŸ‡¬ğŸ‡§ ä½ å¯ä»¥ä½¿ç”¨ä¸­æ–‡ç®€ä½“æˆ–è‹±è¯­ ğŸŒ ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ› ğŸ–¥ ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥ ğŸŒ± å½“ç„¶ Gridea è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´ å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼ ğŸ˜˜ Enjoy~ ","link":"https://youmengme.github.io/gidea/post/hello-gridea/"}]}