<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://youmengme.github.io/gidea</id>
    <title>youmeng - åˆåŒå’å•å†™åšå®¢</title>
    <updated>2021-07-28T15:35:47.816Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://youmengme.github.io/gidea"/>
    <link rel="self" href="https://youmengme.github.io/gidea/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://youmengme.github.io/gidea/images/avatar.png</logo>
    <icon>https://youmengme.github.io/gidea/favicon.ico</icon>
    <rights>All rights reserved 2021, youmeng - åˆåŒå’å•å†™åšå®¢</rights>
    <entry>
        <title type="html"><![CDATA[1. å®ç°ä¸€ä¸ªå¸¦å¹¶å‘é™åˆ¶çš„Promise.all]]></title>
        <id>https://youmengme.github.io/gidea/post/1-shi-xian-yi-ge-dai-bing-fa-xian-zhi-de-promiseall/</id>
        <link href="https://youmengme.github.io/gidea/post/1-shi-xian-yi-ge-dai-bing-fa-xian-zhi-de-promiseall/">
        </link>
        <updated>2021-07-28T15:31:18.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>å¤´æ¡çš„ä¸€é“é¢è¯•é¢˜~~~ emm æœ‰ç‚¹æ„æ€</p>
</blockquote>
<p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå¦‚ç”¨æˆ·è¿›å…¥é¡µé¢ï¼Œä¸€èˆ¬ä¼šé€šè¿‡httpè¯·æ±‚åƒæœåŠ¡ç«¯è·å–æ•°æ®ï¼Œè€Œä¸”å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šæœ‰å¤šä¸ªhttpè¯·æ±‚ã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨<code>Promise.all</code>æ¥è°ƒç”¨æ¥å£ï¼Œä»¥è¾¾åˆ°æ›´å¿«é€Ÿåº¦çš„æ‹¿åˆ°æ•°æ®æ¸²æŸ“é¡µé¢ã€‚<code>Promise.all</code>ä¼šåœ¨æ•°ç»„ä¸­çš„æ‰€æœ‰promiseè¾¾åˆ°<code>resolve</code>çŠ¶æ€åï¼Œæ‰ä¼šå»æ‰§è¡Œ<code>.then</code>çš„å›è°ƒã€‚</p>
<p>ä½†æ˜¯è¿™æ ·ä¹Ÿç»™æœåŠ¡å™¨å¸¦æ¥äº†æ›´å¤§çš„å‹åŠ›ã€‚å¯ä»¥æƒ³è±¡ä¸€ç§æƒ…å†µï¼Œå¦‚æœé¡µé¢ä¸Šæœ‰10w+è¯·æ±‚å¾…å¤„ç†(è¿™é‡Œæš‚ä¸è€ƒè™‘æµè§ˆå™¨çš„è¯·æ±‚å¹¶å‘é™åˆ¶)ï¼Œä½ åˆåªèƒ½åœ¨æ‹¿åˆ°æ‰€æœ‰è¯·æ±‚çš„ç»“æœåæ‰èƒ½å¤šç»“æœè¿›è¡Œå¤„ç†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§å®¶ç†æ‰€å½“ç„¶çš„æƒ³åˆ°äº†<code>Promise.all</code>ã€‚ä½†æ˜¯é¢å¯¹æ´ªæ°´èˆ¬çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå‡ºç°<code>TCP</code>è¿æ¥æ•°ä¸è¶³ç…§æˆç­‰å¾…æˆ–æ‹’ç»è¿æ¥ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹<code>Promise.all</code>è¿›è¡Œå¹¶å‘é™åˆ¶ã€‚</p>
<p><code>Promise.all</code>å¹¶å‘é™åˆ¶æŒ‡çš„æ˜¯å¦‚æœæœ‰10ä¸ªè¯·æ±‚ï¼Œå¹¶å‘é™åˆ¶æ˜¯5ã€‚é‚£ä¹ˆä¼šåœ¨æ‰§è¡Œçš„ä¸€ç¬é—´å‘å‡ºè¯·æ±‚<code>1, 2, 3, 4, 5</code>ï¼Œå½“è¿™5ä¸ªè¯·æ±‚ä¸­ä»»æ„ä¸€ä¸ªæˆåŠŸæˆ–å¤±è´¥åï¼Œç»§ç»­è¯·æ±‚<code>6</code>ï¼Œå¾ªç¯å¾€å¤ï¼Œç›´è‡³10ä¸ªè¯·æ±‚å…¨éƒ¨å®Œæˆã€‚ç„¶åä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰è¯·æ±‚çš„ç»“æœã€‚ä»è¡¨ç°ä¸Šæ¥çœ‹å’ŒåŸæ¥çš„<code>Promise.all</code>æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p>
<h2 id="å¤§è‡´æ€è·¯">å¤§è‡´æ€è·¯</h2>
<ol>
<li><code>await</code>ä¸€ä¸ªpromiseä¼šæš‚åœå½“å‰ä»£ç æ®µç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°promiseå‘ç”Ÿæ”¹å˜ã€‚</li>
<li><code>Promise.race(promises)</code>ä¼šåœ¨<code>promises</code>ä¸­ä»»æ„ä¸€ä¸ªpromiseå‘ç”ŸçŠ¶æ€æ”¹å˜æ—¶è¿”å›ç»“æœã€‚</li>
<li>å¦‚æœä¾æ¬¡å¾ªç¯æ‰€æœ‰å¾…æ‰§è¡Œçš„è¯·æ±‚ï¼Œå°†å…¶æ”¾å…¥å¾…æ‰§è¡Œåˆ—è¡¨ä¸­ï¼Œæ•°é‡è¾¾åˆ°å¹¶å‘é™åˆ¶æ—¶ï¼Œä½¿ç”¨<code>await Promise.race</code>æš‚åœä»£ç æ®µå¹¶æ‰§è¡Œè¿™äº›è¯·æ±‚</li>
<li><code>Promise.race</code>çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œç»§ç»­å¾ªç¯ï¼Œç›´è‡³æ‰§è¡Œå®Œæ‰€æœ‰è¯·æ±‚ã€‚</li>
</ol>
<blockquote>
<p>è¯»åˆ°è¿™é‡Œæ˜¯å¦æœ‰æ€è·¯äº†å‘¢ï¼Ÿå¦‚æœæœ‰ï¼Œé‚£å°±è‡ªå·±å…ˆå†™ç€è¯•è¯•ã€‚çœ‹ç­”æ¡ˆå’Œæ€è€ƒå¾—åˆ°çš„ç»“æœè®°å¿†æ·±åº¦æ˜¯ä¸ä¸€æ ·çš„å“¦~~</p>
</blockquote>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<ol>
<li>å®šä¹‰ä¸¤ä¸ªå˜é‡,<code>array</code>è¡¨ç¤ºå¾…æ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨ï¼Œ<code>limit</code>è¡¨ç¤ºå¹¶å‘é™åˆ¶</li>
<li>éå†å¾…æ‰§è¡Œçš„å‡½æ•°æ•°ç»„
<ol>
<li>ä»<code>array</code>ç¬¬1ä¸ªå…ƒç´ å¼€å§‹ï¼Œåˆå§‹åŒ–<code>promise</code>å¯¹è±¡ï¼ŒåŒæ—¶ç”¨ä¸€ä¸ª<code>executing</code>æ•°ç»„ä¿å­˜æ­£åœ¨æ‰§è¡Œçš„promiseï¼Œå¹¶å°†å…¶å­˜æ”¾äº<code>ret</code>ä¸­</li>
<li>å¾ªç¯åˆå§‹åŒ–promiseï¼Œç›´åˆ°è¾¾åˆ°<code>limt</code></li>
<li>ä½¿ç”¨<code>await Promise.race</code>ï¼Œæš‚åœ<code>for</code>å¾ªç¯ï¼Œå¹¶æ‰§è¡Œ<code>executing</code>ä¸­çš„promiseã€‚</li>
<li>å½“<code>executing</code>ä¸­æœ‰ä»»æ„ä¸€ä¸ªpromiseæ‰§è¡Œå®Œæ¯•ï¼Œå°±ç»§ç»­<code>for</code>å¾ªç¯ï¼Œä¸æ–­åˆå§‹åŒ–promiseå¹¶æ”¾å…¥<code>executing</code>ä¸­ï¼ŒçŸ¥é“è¾¾åˆ°<code>limit</code></li>
<li>å½“æ‰€æœ‰promiseéƒ½æ‰§è¡Œå®Œäº†ï¼Œè°ƒç”¨<code>Promise.all</code>è¿”å›</li>
</ol>
</li>
</ol>
<pre><code class="language-js">async function asyncPool(array, limit) {
	// å­˜å‚¨Promiseçš„æ‰§è¡Œç»“æœ  
  const ret = []
  // æ­£åœ¨æ‰§è¡Œçš„promise
  const executing = []  

  // éå†å¾…æ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨
  for (const item of array) {
    // promiseåŒ…è£…å¹¶æ‰§è¡Œå½“å‰å¾…æ‰§è¡Œå‡½æ•°
    const p = Promise.resolve().then(() =&gt; item(1))
    // å°†å‡½æ•°å­˜è‡³retç»“æœåˆ—è¡¨ä¸­(pæ­¤æ—¶æ˜¯ Promise { &lt;pending&gt; })
    ret.push(p)
    if (limit &lt;= array.length) {
      // åœ¨p.thenæ‰§è¡Œçš„æ—¶å€™è¯´æ˜pçš„çŠ¶æ€å·²ç»å‘ç”Ÿäº†ç¿»è½¬(resolve || reject),
      // æ­¤æ—¶å°†executingåˆ—è¡¨åˆ é™¤ä¸€ä¸ª
      p.then(() =&gt; executing.splice(0, 1))
      // å°†på­˜æ”¾è‡³executingä¸­
      executing.push(p)
     
      // executingå†…çš„å¾…æ‰§è¡Œæ•°é‡å¤§äºç­‰äºlimitçš„æ—¶å€™ï¼Œä½¿ç”¨await Promise.raceæš‚åœforå¾ªç¯ï¼Œ
      // executingä¸­ä»»æ„ä¸€ä¸ªpromiseå‘ç”ŸçŠ¶æ€æ”¹å˜ï¼Œå°±ä¼šç»§ç»­å¾ªç¯
      if (executing.length &gt;= limit) await Promise.race(executing)
    }
  }
  
  return Promise.all(ret)
}

asyncPool([], 10).then(result =&gt; console.log(result))
</code></pre>
<h2 id="æµ‹è¯•ç”¨ä¾‹">æµ‹è¯•ç”¨ä¾‹</h2>
<pre><code class="language-js">const delay = s =&gt; new Promise(resolve =&gt; setTimeout(resolve, s * 1000))

async function request(index) {
  console.log(`Request: ${index}`)
  await delay(1)
  console.log(`Response: ${index}`)
  return index
}

const pool = [...new Array(50).keys()].fill(request)
async function asyncPool(array, limit) {
  const ret = []
  const executing = []  

  for (const itemIndex in array) {
    const item = array[itemIndex]
    const p = Promise.resolve().then(() =&gt; item(itemIndex))
    ret.push(p)
    if (limit &lt;= array.length) {
      p.then(() =&gt; executing.splice(0, 1))
      // console.log('executing', executing)
      executing.push(p)
      if (executing.length &gt;= limit) await Promise.race(executing)
    }
  }

  return Promise.all(ret)
}

asyncPool(pool, 10).then(result =&gt; console.log(result))

</code></pre>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™ä¸ªé¢è¯•é¢˜ä¸»è¦è€ƒäº†å¤š<code>Promise</code>çš„ç†è§£ä¸è¿ç”¨ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šä¸ªç‰ˆæœ¬çš„å®ç°ï¼Œé€’å½’è°ƒç”¨çš„å±…å¤šã€‚emmm...æˆ‘ä¸å–œæ¬¢é€’å½’ï¼Œæ‰€ä»¥æ²¡ç”¨é€’å½’ã€‚</p>
<p>æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¦‚æœè®°å¾—ä¸æ˜¯å¾ˆæ·±åˆ»ï¼Œå»ºè®®<code>Ctrl + D</code>æ”¶è—åˆ°ä¹¦ç­¾ï¼Œä¸‹æ¬¡è®¿é—®æ›´ä¾¿æ·ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://youmengme.github.io/gidea/post/hello-gridea/</id>
        <link href="https://youmengme.github.io/gidea/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>